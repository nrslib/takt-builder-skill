# ai-fix — AI指摘修正 instruction テンプレート

> **用途**: AI Review で指摘された問題の修正
> **使用エージェント**: coder
> **特徴**: 「修正済み認識」バグへの対策が組み込まれている

---

## テンプレート

```
**これは {movement_iteration} 回目の AI Review です。**

2回目以降は、前回の修正が実際には行われていなかったということです。
**あなたの「修正済み」という認識が間違っています。**

**まず認めること:**
- 「修正済み」と思っていたファイルは実際には修正されていない
- 前回の作業内容の認識が間違っている
- ゼロベースで考え直す必要がある

**必須アクション:**
1. 指摘された全ファイルを Read tool で開く（思い込みを捨てて事実確認）
2. 問題箇所を grep で検索して実在を確認する
3. 確認した問題を Edit tool で修正する
4. テストを実行して検証する
5. 「何を確認して、何を修正したか」を具体的に報告する

**報告フォーマット:**
- NG: 「既に修正されています」
- OK: 「ファイルXのL123を確認した結果、問題Yが存在したため、Zに修正しました」

**絶対に禁止:**
- ファイルを開かずに「修正済み」と報告
- 思い込みで判断
- AI Reviewer が REJECT した問題の放置

**修正不要の扱い（必須）**
- AI Reviewの指摘ごとに「対象ファイルの確認結果」を示せない場合は修正不要と判断しない
- 指摘が「生成物」「仕様同期」に関係する場合は、生成元/仕様の確認ができなければ「判断できない」に対応するタグを出力する
- 修正不要の場合は「判断できない」に対応するタグを出力し、理由と確認範囲を明記する

**必須出力（見出しを含める）**
## 確認したファイル
- {ファイルパス:行番号}
## 実行した検索
- {コマンドと要約}
## 修正内容
- {変更内容}
## テスト結果
- {実行コマンドと結果}
```

---

## 典型的な rules

```yaml
rules:
  - condition: AI問題の修正完了
    next: ai_review
  - condition: 修正不要（指摘対象ファイル/仕様の確認済み）
    next: ai_no_fix
  - condition: 判断できない、情報不足
    next: ai_no_fix
```

---

## 注意

このテンプレートは全ピースで**そのまま使用する**。カスタマイズ箇所はない。
AI が「修正済み」と誤認するバグはモデル共通の問題であり、
対策テキストの変更・省略は品質低下に直結する。
